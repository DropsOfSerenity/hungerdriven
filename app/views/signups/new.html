<div class="hero">
    <div class="container text-center">
        <h1>Accessing Fresno's Health</h1>
        <p>Help bring health services to the most critical areas.</p>
    </div>
</div>
<div class="container">
    <!-- columns should be the immediate child of a .row -->
    <div class="row padded">
        <div id="map" class="twelve columns">
        </div>
    </div>
</div>
<div class="row window">
  <div class="container">
    <div class="twelve columns">
        <h2 class="bold text-center">Lorem Ipsum:</h2>
    </div>
    <div class="row pricing text-center">
        <div class="four columns">
            <h2>$5</h2>
            <h5 class="bold">Good</h5>
            <p>Lorem ipsum In pariatur ut proident.</p>
            <ul>
              <li><span>2</span> Bananas</li>
              <li><span>5</span> Apples</li>
              <li><span>2</span> Lorum</li>
            </ul>
            <a class="button" href="javascript:void(0);">Donate</a>
        </div>
        <div class="four columns">
            <h2>$10</h2>
            <h5 class="bold">Better</h5>
            <p>Pariatur lirem ipsum In ut proident.</p>
            <ul>
              <li><span>5</span> Bananas</li>
              <li><span>10</span> Apples</li>
              <li><span>8</span> Lorum</li>
              <li><span>15</span> Apples</li>
            </ul>
            <a class="button" href="javascript:void(0);">Donate</a>
        </div>
        <div class="four columns">
            <h2>$15</h2>
            <h5 class="bold">Best</h5>
            <p>Ipsum lorem in pariatur ut proident.</p>
            <ul>
              <li><span>5</span> Bananas</li>
              <li><span>15</span> Apples</li>
              <li><span>20</span> Lorum</li>
              <li><span>25</span> Ipsum</li>
            </ul>
            <a class="button" href="javascript:void(0);">Donate</a>
        </div>
    </div>
  </div>
</div>

<div class="container">

<!--
<%= form_for :signup, url: signups_path do |f| %>
  <%= f.label :email %>
  <%= f.email_field :email %>

  <%= f.hidden_field :lat %>
  <%= f.hidden_field :lon %>

  <%= f.submit %>
<% end %> -->

</div>

<script>
var map, zip93701, zip93702, zip93650;
$(document).ready(function() {
    GMaps.geolocate({
      success: function(position) {
      $("#signup_lat").val(position.coords.latitude);
      $("#signup_lon").val(position.coords.longitude);
    },
      error: function(error) {
      alert('Geolocation failed: '+error.message);
    },
      not_supported: function() {
      alert("Your browser does not support geolocation");
    },
      always: function() {
    }
    });

    map = new GMaps({
        div: '#map',
        lat: 36.746841,
        lng: -119.772591,
        zoom: 12,
        styles: [{"featureType":"landscape","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"stylers":[{"hue":"#00aaff"},{"saturation":-100},{"gamma":2.15},{"lightness":12}]},{"featureType":"road","elementType":"labels.text.fill","stylers":[{"visibility":"on"},{"lightness":24}]},{"featureType":"road","elementType":"geometry","stylers":[{"lightness":57}]}]
    });

    zip93701 = [
        [36.7503662109375, -119.8134536743164],
        [36.75038528442383, -119.8040542602539],
        [36.752174377441406, -119.8040542602539],
        [36.75221252441406, -119.80281066894531],
        [36.750938415527344, -119.80282592773438],
        [36.75040054321289, -119.80157470703125],
        [36.75043487548828, -119.79622650146484],
        [36.75112533569336, -119.79502868652344],
        [36.75226974487305, -119.79053497314453],
        [36.752655029296875, -119.79158020019531],
        [36.753021240234375, -119.79053497314453],
        [36.754066467285156, -119.79053497314453],
        [36.75405502319336, -119.79278564453125],
        [36.75588607788086, -119.79279327392578],
        [36.75590133666992, -119.79053497314453],
        [36.7577018737793, -119.79054260253906],
        [36.75862503051758, -119.77925872802734],
        [36.7576904296875, -119.7724838256836],
        [36.75485610961914, -119.77250671386719],
        [36.75457763671875, -119.77495574951172],
        [36.75419235229492, -119.77388763427734],
        [36.75414276123047, -119.77310180664062],
        [36.75420379638672, -119.77249145507812],
        [36.75043869018555, -119.7724838256836],
        [36.743167877197266, -119.77243041992188],
        [36.743133544921875, -119.77552795410156],
        [36.74332809448242, -119.7773666381836],
        [36.743309020996094, -119.78939056396484],
        [36.74250030517578, -119.7905044555664],
        [36.74424743652344, -119.7918930053711],
        [36.74424743652344, -119.7957992553711],
        [36.7468147277832, -119.79684448242188],
        [36.744140625, -119.79679870605469],
        [36.7442741394043, -119.80563354492188],
        [36.7447509765625, -119.8072280883789],
        [36.7503662109375, -119.8134536743164]
    ];

    zip93702 = [
        [36.75457763671875, -119.77495574951172],
        [36.75485610961914, -119.77250671386719],
        [36.7576904296875, -119.7724838256836],
        [36.757713317871094, -119.75898742675781],
        [36.7613410949707, -119.75897979736328],
        [36.7613525390625, -119.75672912597656],
        [36.75772476196289, -119.75670623779297],
        [36.75813293457031, -119.75446319580078],
        [36.7581787109375, -119.75],
        [36.75771713256836, -119.7386245727539],
        [36.75861740112305, -119.73863220214844],
        [36.75861740112305, -119.73632049560547],
        [36.75044631958008, -119.73634338378906],
        [36.731929779052734, -119.73637390136719],
        [36.731910705566406, -119.73414611816406],
        [36.72866439819336, -119.73429107666016],
        [36.72866439819336, -119.73194885253906],
        [36.72776412963867, -119.7319564819336],
        [36.72776412963867, -119.7347640991211],
        [36.726905822753906, -119.7347640991211],
        [36.72687530517578, -119.73196411132812],
        [36.72391128540039, -119.73194122314453],
        [36.72393035888672, -119.73104095458984],
        [36.72175216674805, -119.73089599609375],
        [36.72183609008789, -119.72745513916016],
        [36.721370697021484, -119.73637390136719],
        [36.72136688232422, -119.76477813720703],
        [36.72135925292969, -119.7636489868164],
        [36.7187614440918, -119.76365661621094],
        [36.71868896484375, -119.76685333251953],
        [36.7208251953125, -119.76781463623047],
        [36.72071838378906, -119.7715072631836],
        [36.72135543823242, -119.77267456054688],
        [36.72280502319336, -119.77241516113281],
        [36.72864532470703, -119.77176666259766],
        [36.731754302978516, -119.7725601196289],
        [36.743167877197266, -119.77243041992188],
        [36.75043869018555, -119.7724838256836],
        [36.75420379638672, -119.77249145507812],
        [36.75414276123047, -119.77310180664062],
        [36.75419235229492, -119.77388763427734],
        [36.75457763671875, -119.77495574951172]
    ];

   var zip93706 = [
       [36.59645080566406, -120.05242919921875],
       [36.603843688964844, -120.04329681396484],
       [36.66206359863281, -120.04298400878906],
       [36.66214370727539, -120.0245132446289],
       [36.669471740722656, -120.02458190917969],
       [36.66951370239258, -120.01571655273438],
       [36.67681121826172, -120.01605224609375],
       [36.67674255371094, -120.02468872070312],
       [36.69135665893555, -120.02479553222656],
       [36.69135665893555, -120.0050277709961],
       [36.705875396728516, -120.0044174194336],
       [36.70585250854492, -120.00658416748047],
       [36.74235534667969, -120.00607299804688],
       [36.74234390258789, -119.9970932006836],
       [36.73495864868164, -119.99700927734375],
       [36.73496627807617, -119.98812103271484],
       [36.736541748046875, -119.98806762695312],
       [36.742164611816406, -119.96846008300781],
       [36.74235916137695, -119.9517822265625],
       [36.73512268066406, -119.95181274414062],
       [36.73521041870117, -119.9343490600586],
       [36.74248504638672, -119.93426513671875],
       [36.74257278442383, -119.91636657714844],
       [36.73529815673828, -119.91655731201172],
       [36.735450744628906, -119.88975524902344],
       [36.7462043762207, -119.8892593383789],
       [36.74623489379883, -119.88416290283203],
       [36.74960708618164, -119.88140869140625],
       [36.75004577636719, -119.8802261352539],
       [36.74625015258789, -119.8803482055664],
       [36.746307373046875, -119.8712158203125],
       [36.74831771850586, -119.87116241455078],
       [36.748199462890625, -119.86209106445312],
       [36.746341705322266, -119.8621597290039],
       [36.74638366699219, -119.85316467285156],
       [36.74641418457031, -119.84427642822266],
       [36.74641036987305, -119.83554077148438],
       [36.750247955322266, -119.83556365966797],
       [36.75029373168945, -119.81631469726562],
       [36.750083923339844, -119.81512451171875],
       [36.74851608276367, -119.8147201538086],
       [36.74854278564453, -119.81306457519531],
       [36.7503662109375, -119.8134536743164],
       [36.7447509765625, -119.8072280883789],
       [36.7442741394043, -119.80563354492188],
       [36.74345779418945, -119.80579376220703],
       [36.73680877685547, -119.79850769042969],
       [36.7374382019043, -119.79761505126953],
       [36.734405517578125, -119.79431915283203],
       [36.733192443847656, -119.79608917236328],
       [36.7278938293457, -119.7886962890625],
       [36.72470474243164, -119.7851333618164],
       [36.72307586669922, -119.7854995727539],
       [36.72255325317383, -119.78526306152344],
       [36.72166442871094, -119.78425598144531],
       [36.72181701660156, -119.78404235839844],
       [36.720672607421875, -119.78318786621094],
       [36.714195251464844, -119.77606964111328],
       [36.714202880859375, -119.77372741699219],
       [36.713050842285156, -119.77243041992188],
       [36.706878662109375, -119.76564025878906],
       [36.706878662109375, -119.76602172851562],
       [36.706787109375, -119.76856994628906],
       [36.70684051513672, -119.77383422851562],
       [36.705074310302734, -119.77212524414062],
       [36.70436096191406, -119.77175903320312],
       [36.70432662963867, -119.77271270751953],
       [36.69963073730469, -119.7726821899414],
       [36.6995735168457, -119.78174591064453],
       [36.688385009765625, -119.78173828125],
       [36.68837356567383, -119.77716827392578],
       [36.6867561340332, -119.77721405029297],
       [36.68668746948242, -119.77273559570312],
       [36.66698455810547, -119.77275085449219],
       [36.6669807434082, -119.78176879882812],
       [36.656036376953125, -119.78177642822266],
       [36.656070709228516, -119.77275848388672],
       [36.6487922668457, -119.77277374267578],
       [36.64876937866211, -119.78180694580078],
       [36.64697265625, -119.78180694580078],
       [36.64697265625, -119.77959442138672],
       [36.642642974853516, -119.77989196777344],
       [36.64151382446289, -119.78181457519531],
       [36.64152145385742, -119.78556060791016],
       [36.63518524169922, -119.78581237792969],
       [36.63426208496094, -119.78617095947266],
       [36.5533447265625, -119.78628540039062],
       [36.55459976196289, -119.78765106201172],
       [36.55455780029297, -119.79993438720703],
       [36.56182861328125, -119.79989624023438],
       [36.561805725097656, -119.8088607788086],
       [36.569068908691406, -119.80890655517578],
       [36.568973541259766, -119.83589935302734],
       [36.576133728027344, -119.83589172363281],
       [36.57594299316406, -119.86295318603516],
       [36.56869125366211, -119.86300659179688],
       [36.570919036865234, -119.8656234741211],
       [36.570655822753906, -119.88102722167969],
       [36.57522964477539, -119.89002990722656],
       [36.57576370239258, -119.89002990722656],
       [36.57583236694336, -119.88101196289062],
       [36.58308410644531, -119.8809585571289],
       [36.58295440673828, -119.89900970458984],
       [36.59022521972656, -119.89897155761719],
       [36.590293884277344, -119.88858795166016],
       [36.59144973754883, -119.88995361328125],
       [36.604793548583984, -119.8898696899414],
       [36.60470199584961, -119.9034652709961],
       [36.60834884643555, -119.90336608886719],
       [36.60831832885742, -119.90789794921875],
       [36.606529235839844, -119.90788269042969],
       [36.604679107666016, -119.9056167602539],
       [36.604576110839844, -119.91691589355469],
       [36.582828521728516, -119.91705322265625],
       [36.575565338134766, -119.91709899902344],
       [36.57528305053711, -119.95343780517578],
       [36.54685592651367, -119.95362091064453],
       [36.546817779541016, -119.96073913574219],
       [36.54777908325195, -119.96073913574219],
       [36.546600341796875, -120.00098419189453],
       [36.54655075073242, -120.01652526855469],
       [36.553871154785156, -120.01649475097656],
       [36.55378341674805, -120.02531433105469],
       [36.58929443359375, -120.02555084228516],
       [36.58913803100586, -120.0389404296875],
       [36.59089279174805, -120.03811645507812],
       [36.593994140625, -120.038330078125],
       [36.59405517578125, -120.05223846435547],
       [36.59645080566406, -120.05242919921875]
   ];


    var z1 = map.drawPolygon({
        paths: zip93701,
        strokeColor: '#000000',
        strokeOpacity: 1,
        strokeWeight: 3,
        fillColor: 'red',
        fillOpacity: 0.7
    });

    var z2 = map.drawPolygon({
        paths: zip93702,
        strokeColor: '#000000',
        strokeOpacity: 1,
        strokeWeight: 3,
        fillColor: 'red',
        fillOpacity: 0.4
    });

    var z3 = map.drawPolygon({
        paths: zip93706,
        strokeColor: '#000000',
        strokeOpacity: 1,
        strokeWeight: 3,
        fillColor: 'red',
        fillOpacity: 0.1
    });

    $.ajax({
        url: 'https://cdph.data.ca.gov/resource/6g28-ddys.json?zipcode=93706&year=2012',
        method: 'GET',
        success: function(data) {
          var under1500club = _.each(data, function(d) {
            if (d.birthweght == "UNDER 1500g" || d.birthweght == "1500-2499g")
              console.log("under 2499 - ", d.year, d.count);
            if (d.birthweght == "2500+ grams")
              console.log("2500+ - ", d.year, d.count);
          });
        }
    });

    $.ajax({
        url: 'https://cdph.data.ca.gov/resource/n8ju-ifrh.json?city=fresno',
        method: 'GET',
        success: function(data) {

          var filteredData = _.filter(data, function(d) {
            return d.fac_type_fdr == "Surgical Clinic \t"
          });

          _.each(filteredData, function(d) {
            map.addMarker({
              lat: d.latitude,
              lng: d.longitude,
              infoWindow: {
                content: '<p>' + d.name + '<br>'
                          + d.address + ", " + d.zip + " " + d.city + '<br>'
                          + d.contact_phone_number + '</p>'

              },
              icon: "http://www2.wlv.ac.uk/interactive-map/images/icons/miscellaneous/hospital.png"
            });
          })
          console.log(filteredData);
        }
    });

    var signups = <%= @signups %>;
    console.log(signups);

    _.each(signups, function(signup) {
        map.addMarker({
          lat: signup[0],
          lng: signup[1],
          icon: "http://png-4.findicons.com/files/icons/1690/developpers/32/smiley.png"
        });
    });

    function createClickablePoly(poly, html, label, point) {
      gpolys.push(poly);
      if (!point && poly.getPath
          && poly.getPath().getLength
          && (poly.getPath().getLength > 0)
          && poly.getPath().getAt(0)) { point = poly.getPath().getAt(0); }
      var poly_num = gpolys.length - 1;
      if (!html) {html = "";}
      else { html += "<br>";}
      var length = poly.Distance();
      if (length > 1000) {
        html += "length="+poly.Distance().toFixed(3)/1000+" km";
      } else {
        html += "length="+poly.Distance().toFixed(3)+" meters";
      }
      for (var i=0;i<poly.getPath().getLength();i++) {
        html += "<br>poly["+poly_num+"]["+i+"]="+poly.getPath().getAt(i);
      }
      html += "<br>Area: "+poly.Area()+" sq meters";
      // html += poly.getLength().toFixed(2)+" m; "+(poly.getLength()*3.2808399).toFixed(2)+" ft; ";
      // html += (poly.getLength()*0.000621371192).toFixed(2)+" miles";
      var contentString = html;
      google.maps.event.addListener(poly,'click', function(event) {
          infowindow.setContent(contentString);
          if (event) {
          point = event.latLng;
          }
          infowindow.setPosition(point);
          infowindow.open(map);
          // map.openInfoWindowHtml(point,html);
          });
      if (!label) {
        label = "polyline #"+poly_num;
      }
      label = "<a href='javascript:google.maps.event.trigger(gpolys["+poly_num+"],\"click\");'>"+label+"</a>";
      // add a line to the sidebar html
      //  side_bar_html += '<input type="checkbox" id="poly'+poly_num+'" checked="checked" onclick="togglePoly('+poly_num+');">' + label + '<br />';
    }

});
</script>
